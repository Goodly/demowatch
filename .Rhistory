training_dat <- dat %>%
group_by(task_id) %>%
slice(1) %>%
select(c("task_id", "info_article_text", "info_article_id"))
View(training_dat)
day_from_date <- function(adate = NULL) {
if (!is.null(adate)) {
day_list <- c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday",
"Saturday")
dow <- try(which(grepl(weekdays(as.Date(adate, "%m-%d-%y")), day_list)), silent=TRUE)
if(inherits(dow, "try-error")) dow <- NA
return(dow)
}
}
day_from_date("2011-11-02")
day_from_date(as.date("2011-11-02"))
day_from_date(as.Date("2011-11-02"))
return_days <- function(text) {
if(!is.na(text)){
if(is.character(text)) {
day_list <- c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday",
"Saturday")
res <- as.numeric(which(sapply(day_list, grepl, text, ignore.case = TRUE)))
if (length(res) == 0) {
res <- NA
} else {
res<-res[1] # we can add more handling here to deal with multiple weekday mentions
}
}
} else res <- NA
return(res)
}
return_days("Monday Tuesday, Friday")
as.Date("2011-11-02") - 2
library(jsonlite)
read_json("~/Desktop/downloads/dfcrowd1dh-2018-06-21T01.json")
dat <- read_json("~/Desktop/downloads/dfcrowd1dh-2018-06-21T01.json")
results <- dat$results
length(results$text)
results
results <- dat$results[[]]
results <- dat$results
unlist(results)
results[[2]]
results$text
results[1]
dim(results)
length(results)
View(results)
library(readr)
dat <- read_csv("~/Desktop/downloads/dfcrowd1dh-2018-06-21T01.csv")
View(dat)
library(dplyr)
library(reshape2)
View(dat)
molten_dat <- melt(dat, id.vars = c("task_pybossa_id", "contributor_id"))
dat_json <- read_json("~/Desktop/downloads/dfcrowd1dh-2018-06-21T01.json")
results <- dat_json$results
library(jsonlite)
dat_json <- read_json("~/Desktop/downloads/dfcrowd1dh-2018-06-21T01.json")
results <- dat_json$results
View(results)
dat %>% grouped_by(contributor_id, topic_number, question_number)
dat %>% group_by(contributor_id, topic_number, question_number)
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number)
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("count" = n())
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = function(x) {return(list(x))} )
identity
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = identity() )
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = identity())
summarise("answer_list" = identity
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = identity)
dat %>%
group_by(contributor_id, topic_number, question_number)
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number)
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = identity)
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = identity(answer_number))
identity(answer_list)
identity(answer_number)
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = list(answer_number))
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise("answer_list" = paste(answer_number))
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise(answer_list = paste(answer_number))
dat %>%
group_by(contributor_id, topic_number, question_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarise(answer_list = paste(answer_number, collapse = ", "))
dat %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number)
dat %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarize(count = n())
dat %>%
filter(task_pybossa_id == 372) %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
summarize(count = n())
dat %>%
filter(task_pybossa_id == 372) %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
group_by(contributor_id, topic_number, question_number) %>%
summarize(answer_list = paste(answer_number, collapse = ", "))
dat %>%
filter(task_pybossa_id == 372) %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
group_by(contributor_id, topic_number, question_number) %>%
summarize(answer_list = list(answer_number))
grouped_dat <- dat %>%
filter(task_pybossa_id == 372) %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
group_by(contributor_id, topic_number, question_number) %>%
summarize(answer_list = list(answer_number))
View(grouped_dat)
grouped_dat <- dat %>%
filter(task_pybossa_id == 372) %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
group_by(contributor_id, topic_number, question_number) %>%
summarize(answer_list = unique(answer_number))
grouped_dat <- dat %>%
filter(task_pybossa_id == 372) %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
group_by(contributor_id, topic_number, question_number) %>%
summarize(answer_list = unique(list(answer_number)))
View(grouped_dat)
grouped_dat <- dat %>%
filter(task_pybossa_id == 372) %>%
group_by(contributor_id, topic_number, question_number, answer_number) %>%
select(contributor_id, topic_number, question_number, answer_number) %>%
group_by(contributor_id, topic_number, question_number) %>%
summarize(answer_list = list(unique(answer_number)))
View(grouped_dat)
grouped_dat <- dat %>%
group_by(task_pybossa_id,
contributor_id,
topic_number,
question_number,
answer_number) %>%
select(task_pybossa_id,
contributor_id,
topic_number,
question_number,
answer_number) %>%
group_by(task_pybossa_id ,
contributor_id,
topic_number,
question_number) %>%
summarize(answer_list = list(unique(answer_number)))
View(grouped_dat)
molten_dat <- melt(dat,
id.vars = c("task_pybossa_id", "contributor_id"),
measure.vars = c("answer_list"))
molten_dat <- melt(grouped_dat,
id.vars = c("task_pybossa_id", "contributor_id"),
measure.vars = c("answer_list"))
molten_dat <- melt(grouped_dat,
id.vars = c("task_pybossa_id", "contributor_id"))
library(readr)
reading_set <- read_csv("df-canonicalization/notebooks/reading_set.csv")
dir <- "~/df-canonicalization"
reading_set <- read_csv(paste0(dir, "notebooks/reading_set.csv"))
reading_set <- read_csv(paste0(dir, "/notebooks/reading_set.csv"))
setwd(dir)
reading_set <- read_csv("/notebooks/reading_set.csv")
reading_set <- read_csv("notebooks/reading_set.csv")
city_names <- list.files("data/city")
city_names
city_names <- grep(list.files("data/city"), ".csv", "")
?grep
city_names <- gsub(".csv", "", list.files("data/city"))
city_names
city_names <- gsub("+", " ", gsub(".csv", "", list.files("data/city")))
city_names
city_names <- gsub("A", " ", gsub(".csv", "", list.files("data/city")))
city_names
city_names <- gsub("\+", " ", gsub(".csv", "", list.files("data/city")))
city_names <- gsub("/+", " ", gsub(".csv", "", list.files("data/city")))
city_names
city_names <- gsub("+", " ", gsub(".csv", "", list.files("data/city")))
city_names <- gsub("\\+", " ", gsub(".csv", "", list.files("data/city")))
city_names
file_names <- list.files("data/city")
hand_labels <- read_csv(paste0(city_data_dir, file_names[1]))
city_data_dir <- "data/city"
hand_labels <- read_csv(paste0(city_data_dir, file_names[1]))
city_data_dir <- "data/city/"
dir <- "~/df-canonicalization/"
setwd(dir)
reading_set <- read_csv("notebooks/reading_set.csv")
file_names <- list.files("data/city")
city_names <- gsub("\\+", " ", gsub(".csv", "", list.files("data/city")))
city_data_dir <- "data/city/"
hand_labels <- read_csv(paste0(city_data_dir, file_names[1]))
View(hand_labels)
hand_labels <- cbind(file_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
View(hand_labels)
hand_labels <- cbind(city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
View(hand_labels)
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
View(hand_labels)
}
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj], read_csv(file_names[obj])
hand_labels <- rbind(hand_labels, new_city)
}
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj], read_csv(file_names[obj]))
hand_labels <- rbind(hand_labels, new_city)
}
}
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj], read_csv(paste0(city_data_dir,
file_names[obj])))
hand_labels <- rbind(hand_labels, new_city)
}
View(hand_labels)
city_data_dir <- "data/city/"
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
nrow(hand_labels))
hand_labels <- rbind(hand_labels, new_city)
}
View(hand_labels)
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
View(hand_labels)
View(reading_set)
print(obj)
for (obj in 1:length(unique(reading_set$city))) {
print(obj)
}
unique_cities <- unique(reading_set$city)
unique_cities[1]
unique_cities[1] %in% city_names
for (obj in 1:length(unique_cities)) {
current_city <- unique_cities[obj]
if (unique_cities %in% city_names) {
next
} else {
hand_labels <- rbind(hand_labels,
c(current_city, max(hand_labels$ID) + 1))
}
}
View(hand_labels)
warnings()
for (obj in 1:length(unique_cities)) {
current_city <- unique_cities[obj]
if (current_city %in% city_names) {
next
} else {
hand_labels <- rbind(hand_labels,
c(current_city, max(hand_labels$ID) + 1))
}
}
max(hand+)
max(hand_labels$ID)
max(hand_labels$ID) + 1
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
unique_cities <- unique(reading_set$city)
View(hand_labels)
max(hand_labels$ID)
max(hand_labels$ID) + 1
for (obj in 1:length(unique_cities)) {
current_city <- unique_cities[obj]
if (current_city %in% city_names) {
next
} else {
hand_labels <- rbind(hand_labels,
c(current_city, max(hand_labels$ID) + 1))
}
}
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
unique_cities <- unique(reading_set$city)
rbind(hand_labels, c(current_city, 1))
rbind(hand_labels, c(city = current_city, ID = 1))
c(city = "Cleveland", ID = 1)
list("cleveland", 1)
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
rbind(hand_labels, list(current_city, max(hand_labels$ID) + 1))
?read_csv
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1]),
col_types = "ci"))
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1]),
col_types = "cn"))
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1]),
col_types = c("c", "i")))
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1]),
col_types = cols("ci")))
hand_labels %>% mutate(city = as.character(city))
library(dplyr)
library(readr)
hand_labels %>% mutate(city = as.character(city))
city_data_dir <- "data/city/"
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
hand_labels <- hand_labels %>% mutate(city = as.character(city))
View(hand_labels)
unique_cities <- unique(reading_set$city)
for (obj in 1:length(unique_cities)) {
current_city <- unique_cities[obj]
if (current_city %in% city_names) {
next
} else {
hand_labels <- rbind(hand_labels,
c(current_city, max(hand_labels$ID) + 1))
}
}
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
hand_labels <- hand_labels %>% mutate(city = as.character(city))
unique_cities <- unique(reading_set$city)
hand_labels <- rbind(hand_labels,
list(current_city, max(hand_labels$ID) + 1))
View(hand_labels)
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
hand_labels <- hand_labels %>% mutate(city = as.character(city))
unique_cities <- unique(reading_set$city)
for (obj in 1:length(unique_cities)) {
current_city <- unique_cities[obj]
if (current_city %in% city_names) {
next
} else {
hand_labels <- rbind(hand_labels,
list(current_city, max(hand_labels$ID) + 1))
}
}
View(hand_labels)
table(hand_labels)
?table
table(hand_labels$city)
sort(table(hand_labels$city))
View(reading_set)
dir <- "~/df-canonicalization/"
setwd(dir)
reading_set <- read_csv("notebooks/reading_set.csv")
file_names <- list.files("data/city")
city_names <- gsub("\\+", " ", gsub(".csv", "", list.files("data/city")))
city_data_dir <- "data/city/"
hand_labels <- cbind(city = city_names[1],
read_csv(paste0(city_data_dir, file_names[1])))
for (obj in 2:length(file_names)) {
new_city <- cbind(city = city_names[obj],
read_csv(paste0(city_data_dir, file_names[obj])) +
max(hand_labels[, 2]))
hand_labels <- rbind(hand_labels, new_city)
}
hand_labels <- hand_labels %>% mutate(city = as.character(city))
unique_cities <- unique(reading_set$city)
for (obj in 1:length(unique_cities)) {
current_city <- unique_cities[obj]
if (current_city %in% city_names) {
next
} else {
hand_labels <- rbind(hand_labels,
list(current_city, max(hand_labels$ID) + 1))
}
}
View(reading_set)
reading_set %>% filter(city == "Charleston")
reading_set %>% filter(city == "Charleston") %>% inner_join(hand_labels)
labelled_tbl <- cbind(city_tbl, ID = city_labels$ID)
for (obj in 1:length(unique_cities)) {
city_tbl <- reading_set %>% filter(city == unique_cities[obj])
city_labels <- hand_labels %>% filter(city == unique_cities[obj])
labelled_tbl <- cbind(city_tbl, ID = city_labels$ID)
}
View(labelled_tbl)
View(hand_labels)
View(reading_set)
labelled_tbl <- cbind(reading_set %>% filter(city == "Charleston"),
hand_labels %>% filter(city == "Charleston"))
View(labelled_tbl)
for (obj in 2:length(unique_cities)) {
city_tbl <- reading_set %>% filter(city == unique_cities[obj])
city_labels <- hand_labels %>% filter(city == unique_cities[obj])
labelled_tbl <- cbind(city_tbl, ID = city_labels$ID)
}
labelled_tbl <- cbind(reading_set %>% filter(city == "Charleston"),
hand_labels %>% filter(city == "Charleston"))
for (obj in 2:length(unique_cities)) {
city_tbl <- reading_set %>% filter(city == unique_cities[obj])
city_labels <- hand_labels %>% filter(city == unique_cities[obj])
labelled_tbl <- rbind(labelled_tbl, cbind(city_tbl, ID = city_labels$ID))
}
View(labelled_tbl)
labelled_tbl <- cbind(reading_set %>% filter(city == "Charleston"),
hand_labels %>%
filter(city == "Charleston") %>%
select(ID))
View(labelled_tbl)
for (obj in 2:length(unique_cities)) {
city_tbl <- reading_set %>% filter(city == unique_cities[obj])
city_labels <- hand_labels %>% filter(city == unique_cities[obj])
labelled_tbl <- rbind(labelled_tbl, cbind(city_tbl, ID = city_labels$ID))
}
View(labelled_tbl)
labelled_tbl <- labelled_tbl %>% select(city, date, text, ID)
?write_csv
write_csv(labelled_tbl, "validation_set.csv")
